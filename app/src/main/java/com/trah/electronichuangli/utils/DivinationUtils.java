package com.trah.electronichuangli.utils;

/**
 * 卜卦算法工具类
 * 实现传统六爻八卦系统，包含完整的64卦体系
 * 
 * @author trah
 * @version 1.0
 */
public class DivinationUtils {
    
    // ==================== 六十四卦名称数组 ====================
    private static final String[] GUA_NAMES = {
        "乾卦", "坤卦", "屯卦", "蒙卦", "需卦", "讼卦", "师卦", "比卦",
        "小畜", "履卦", "泰卦", "否卦", "同人", "大有", "谦卦", "豫卦",
        "随卦", "蛊卦", "临卦", "观卦", "噬嗑", "贲卦", "剥卦", "复卦",
        "无妄", "大畜", "颐卦", "大过", "坎卦", "离卦", "咸卦", "恒卦",
        "遁卦", "大壮", "晋卦", "明夷", "家人", "睽卦", "蹇卦", "解卦",
        "损卦", "益卦", "夬卦", "姤卦", "萃卦", "升卦", "困卦", "井卦",
        "革卦", "鼎卦", "震卦", "艮卦", "渐卦", "归妹", "丰卦", "旅卦",
        "巽卦", "兑卦", "涣卦", "节卦", "中孚", "小过", "既济", "未济"
    };
    
    // ==================== 卦象符号（Unicode八卦符号）====================
    private static final String[] GUA_SYMBOLS = {
        "☰☰", "☷☷", "☳☵", "☵☶", "☰☵", "☵☰", "☷☵", "☵☷",
        "☰☴", "☱☰", "☰☷", "☷☰", "☰☲", "☲☰", "☷☶", "☳☷",
        "☱☳", "☶☴", "☱☷", "☰☴", "☲☳", "☶☲", "☷☶", "☳☷",
        "☰☳", "☶☰", "☶☳", "☱☴", "☵☵", "☲☲", "☱☶", "☳☴",
        "☰☶", "☳☰", "☲☷", "☷☲", "☴☲", "☲☱", "☵☶", "☳☵",
        "☶☱", "☴☳", "☱☰", "☰☴", "☱☷", "☷☴", "☵☱", "☴☵",
        "☱☲", "☲☴", "☳☳", "☶☶", "☴☶", "☱☳", "☲☳", "☶☲",
        "☴☴", "☱☱", "☴☵", "☱☵", "☴☶", "☳☶", "☲☵", "☵☲"
    };
    
    // ==================== 八卦基础符号 ====================
    private static final String[] BAGUA = {"☰", "☱", "☲", "☳", "☴", "☵", "☶", "☷"};
    private static final String[] BAGUA_NAMES = {"乾", "兑", "离", "震", "巽", "坎", "艮", "坤"};
    private static final String[] BAGUA_NATURE = {"天", "泽", "火", "雷", "风", "水", "山", "地"};
    
    // ==================== 卦辞数组（完整版）====================
    private static final String[] GUA_CI = {
        "元，亨，利，贞。", // 0-乾卦
        "元亨，利牝马之贞。", // 1-坤卦
        "元亨，利贞，勿用有攸往，利建侯。", // 2-屯卦
        "亨。匪我求童蒙，童蒙求我。", // 3-蒙卦
        "有孚，光亨，贞吉，利涉大川。", // 4-需卦
        "有孚，窒惕，中吉，终凶，利见大人，不利涉大川。", // 5-讼卦
        "贞，丈人，吉，无咎。", // 6-师卦
        "吉。原筮元永贞，无咎。", // 7-比卦
        "小亨，密云不雨，自我西郊。", // 8-小畜卦
        "履虎尾，不咥人，亨。", // 9-履卦
        "小往大来，吉，亨。", // 10-泰卦
        "否之匪人，不利君子贞，大往小来。", // 11-否卦
        "同人于野，亨，利涉大川，利君子贞。", // 12-同人卦
        "元亨。", // 13-大有卦
        "亨，君子有终。", // 14-谦卦
        "利建侯行师。", // 15-豫卦
        "元亨，利贞，天下随时，随时之义大矣哉。", // 16-随卦
        "元亨，利涉大川，先甲三日，后甲三日。", // 17-蛊卦
        "元亨，利贞，至于八月有凶。", // 18-临卦
        "盥而不荐，有孚颙若。", // 19-观卦
        "亨，利用狱。", // 20-噬嗑卦
        "亨，小利有攸往。", // 21-贲卦
        "不利有攸往。", // 22-剥卦
        "亨，出入无疾，朋来无咎。", // 23-复卦
        "元亨，利贞，其匪正有眚，不利有攸往。", // 24-无妄卦
        "利贞，不家食吉，利涉大川。", // 25-大畜卦
        "贞吉，观颐，自求口实。", // 26-颐卦
        "利有攸往，亨。", // 27-大过卦
        "习坎，有孚，维心亨，行有尚。", // 28-坎卦
        "利贞，亨，畜牝牛吉。", // 29-离卦
        "亨，利贞，取女吉。", // 30-咸卦
        "亨，无咎，利贞，利有攸往。", // 31-恒卦
        "亨，小利贞。", // 32-遁卦
        "利贞。", // 33-大壮卦
        "康侯用锡马蕃庶，昼日三接。", // 34-晋卦
        "利艰贞。", // 35-明夷卦
        "利女贞。", // 36-家人卦
        "小事吉。", // 37-睽卦
        "利西南，不利东北，利见大人，贞吉。", // 38-蹇卦
        "利西南，无所往，其来复吉，有攸往夙吉。", // 39-解卦
        "有孚，元吉，无咎，可贞，利有攸往。", // 40-损卦
        "利有攸往，利涉大川。", // 41-益卦
        "扬于王庭，孚号有厉，告自邑，不利即戎，利有攸往。", // 42-夬卦
        "女壮，勿用取女。", // 43-姤卦
        "亨，王假有庙，利见大人，亨，利贞。", // 44-萃卦
        "元亨，用见大人，勿恤，南征吉。", // 45-升卦
        "亨，贞，大人吉，无咎，有言不信。", // 46-困卦
        "改邑不改井，无丧无得，往来井井。", // 47-井卦
        "己日乃孚，元亨，利贞，悔亡。", // 48-革卦
        "元吉，亨。", // 49-鼎卦
        "亨，震来虩虩，笑言哑哑，震惊百里，不丧匕鬯。", // 50-震卦
        "艮其背，不获其身，行其庭，不见其人，无咎。", // 51-艮卦
        "进退，利贞，利见大人。", // 52-渐卦
        "征凶，无攸利。", // 53-归妹卦
        "亨，王假之，勿忧，宜日中。", // 54-丰卦
        "小亨，旅贞吉。", // 55-旅卦
        "小亨，利有攸往，利见大人。", // 56-巽卦
        "亨，利贞。", // 57-兑卦
        "亨，王假有庙，利涉大川，利贞。", // 58-涣卦
        "亨，苦节不可贞。", // 59-节卦
        "豚鱼吉，利涉大川，利贞。", // 60-中孚卦
        "亨，利贞，利小事，不利大事。", // 61-小过卦
        "亨，小利贞，初吉终乱。", // 62-既济卦
        "亨，小利贞，初吉终乱。" // 63-未济卦
    };
    
    // ==================== 现代解释数组（完整版）====================
    private static final String[] MODERN_INTERPRETATIONS = {
        "乾卦象征天，代表刚健、进取、领导力量。此时正是积极进取的好时机，事业方面宜主动出击，感情需要坚持，财运通过努力获得，身体强健有活力。", // 0-乾卦
        "坤卦象征大地，代表柔顺、包容、厚德载物。此时适合以柔制刚，事业需要耐心经营，感情温和包容，财运稳定增长，健康需要细心调养。", // 1-坤卦
        "屯卦如婴儿初生，万事开头难但充满希望。事业刚起步会遇到困难，但前景光明，感情需要耐心培养，财运渐入佳境，身体需要保养。", // 2-屯卦
        "蒙卦代表启蒙教育，智慧初开。事业需要不断学习提升，感情需要真诚沟通了解，财运通过学习投资获得，身心需要平衡发展。", // 3-蒙卦
        "需卦象征等待时机，如云聚待雨。事业需要耐心等候良机，感情需要真心等待，财运需要慢慢积累，身体需要休养生息。", // 4-需卦
        "讼卦代表争执诉讼，矛盾尖锐。事业可能遇到法律纠纷，感情容易发生争吵，财运因争端而损失，身心容易紧张焦虑。", // 5-讼卦
        "师卦象征军队出征，纪律严明。事业需要团队合作和领导能力，感情需要责任担当，财运通过正当途径获得，身体需要锻炼强壮。", // 6-师卦
        "比卦代表亲近团结，和谐共处。事业有贵人相助合作愉快，感情和睦融洽，财运通过人脉合作获得，身心愉悦健康。", // 7-比卦
        "小畜卦如云聚不雨，力量尚小。事业需要积累实力，暂时难有大突破，感情需要细水长流，财运有小收入但不够丰厚，身体基本健康。", // 8-小畜卦
        "履卦如履虎尾，危险但不伤。事业需要谨慎行事但前景良好，感情需要小心维护，财运稳中有升，身体需要注意安全。", // 9-履卦
        "泰卦天地相交，万物通泰。事业蒸蒸日上前程似锦，感情甜蜜美满，财运大好收入颇丰，身体健康精力充沛。", // 10-泰卦
        "否卦天地不交，闭塞不通。事业遇到阻碍发展困难，感情可能出现隔阂，财运不佳支出大于收入，身心需要调节。", // 11-否卦
        "同人卦代表志同道合，团结一心。事业适合与人合作发展，感情理念相合，财运通过团队协作获得，身心与众人和谐。", // 12-同人卦
        "大有卦象征丰收富有，成果辉煌。事业成功收获巨大，感情充实美满，财运极佳收入丰厚，身体健康状态极佳。", // 13-大有卦
        "谦卦代表谦虚谨慎，德行高尚。事业因谦逊而获得他人支持，感情因包容而和谐，财运因品德而来，身心因谦和而健康。", // 14-谦卦
        "豫卦象征快乐预备，顺势而为。事业发展顺利值得高兴，感情愉快甜蜜，财运顺畅收入稳定，身心愉悦精神饱满。", // 15-豫卦
        "随卦代表随时而动，顺应潮流。事业需要随机应变适应变化，感情需要相互迁就，财运随市场而动，身心需要顺应自然。", // 16-随卦
        "蛊卦象征腐败需要整治。事业需要改革创新除旧布新，感情需要解决积年矛盾，财运需要清理整顿，身体需要排毒调理。", // 17-蛊卦
        "临卦代表来临监督，实力增强。事业正在上升期需要把握机会，感情逐渐升温，财运开始好转，身体逐渐强健。", // 18-临卦
        "观卦象征观察学习，深思熟虑。事业需要仔细观察市场，感情需要深入了解对方，财运需要理性分析，身心需要静养观察。", // 19-观卦
        "噬嗑卦如咬合食物，排除障碍。事业需要克服困难排除阻碍，感情需要解决误会，财运需要努力争取，身体需要治疗调理。", // 20-噬嗑卦
        "贲卦代表文饰美化，外在光彩。事业需要包装营销提升形象，感情需要浪漫装饰，财运表面光鲜但需务实，身体需要美容保养。", // 21-贲卦
        "剥卦象征剥落衰败，时运不济。事业面临危机需要保守应对，感情可能遭受打击，财运下滑需要节流，身体抵抗力下降。", // 22-剥卦
        "复卦代表回归复苏，重新开始。事业经过低谷后开始回升，感情重燃希望，财运开始复苏，身体逐渐恢复健康。", // 23-复卦
        "无妄卦象征纯真无邪，顺应天意。事业需要诚实经营不可投机，感情需要真诚相待，财运来自正当途径，身心保持纯真。", // 24-无妄卦
        "大畜卦代表大量储蓄，厚积薄发。事业需要积累实力等待时机，感情需要深厚基础，财运需要长期投资，身体需要养精蓄锐。", // 25-大畜卦
        "颐卦象征颐养生息，注重修养。事业需要稳固基础细心经营，感情需要用心滋养，财运需要节制消费，身体需要精心调养。", // 26-颐卦
        "大过卦代表过犹不及，需要调节。事业发展过快需要稳定，感情过于激烈需要冷静，财运有过度投资风险，身体需要调节平衡。", // 27-大过卦
        "坎卦象征险陷重重，需要坚持。事业遇到重重困难但要坚持，感情经历考验，财运有风险需要谨慎，身体需要克服疾病。", // 28-坎卦
        "离卦代表光明附着，智慧照耀。事业前景光明需要智慧经营，感情热烈光明，财运通过智慧获得，身心光明健康。", // 29-离卦
        "咸卦象征感应相通，心心相印。事业需要感知市场变化，感情相互感应默契十足，财运需要敏锐感知机会，身心感应和谐。", // 30-咸卦
        "恒卦代表恒久持续，坚持不懈。事业需要长期坚持才能成功，感情需要恒久相守，财运需要持续经营，身体需要长期保养。", // 31-恒卦
        "遁卦象征退避隐遁，明哲保身。事业需要暂时退让保存实力，感情需要给彼此空间，财运需要保守理财，身心需要休养。", // 32-遁卦
        "大壮卦代表实力强大，但需谦逊。事业实力雄厚但不可骄傲，感情充满活力但需要节制，财运强劲但需要稳健，身体强壮但需保养。", // 33-大壮卦
        "晋卦象征上进发展，前程似锦。事业蒸蒸日上前景光明，感情逐步升温发展良好，财运持续上升，身体健康向上。", // 34-晋卦
        "明夷卦代表光明受伤，需要忍耐。事业可能遭受打击需要坚忍，感情经历黑暗期需要等待，财运不佳需要节约，身心需要恢复。", // 35-明夷卦
        "家人卦象征家庭和睦，各司其职。事业如治家需要规划有序，感情家庭和谐，财运家庭收入稳定，身心在家庭中得到温暖。", // 36-家人卦
        "睽卦代表背离分歧，需要沟通。事业合作中出现分歧需要协调，感情存在误解需要沟通，财运因分歧而受损，身心需要调和。", // 37-睽卦
        "蹇卦象征艰难险阻，进退两难。事业遇到重大困难需要智慧解决，感情面临考验，财运困难需要开源节流，身体需要克服疾病。", // 38-蹇卦
        "解卦代表解脱困境，雨过天晴。事业困难开始解决柳暗花明，感情误会消除重归于好，财运困境解除开始好转，身心得到解脱。", // 39-解卦
        "损卦象征减少损失，以退为进。事业需要适当收缩减少损失，感情需要付出牺牲，财运需要减少开支，身体需要减负调养。", // 40-损卦
        "益卦代表增益获利，助人助己。事业有贵人相助获得发展，感情相互帮助感情加深，财运增加收入来源，身心得到滋养。", // 41-益卦
        "夬卦象征决断分离，当机立断。事业需要果断决策不可犹豫，感情需要做出选择，财运需要果断投资决策，身心需要决断。", // 42-夬卦
        "姤卦代表意外相遇，防范小人。事业可能遇到意外机会或陷阱，感情可能有第三者介入，财运有意外之财但需防范，身体需要预防意外。", // 43-姤卦
        "萃卦象征聚集汇合，众志成城。事业适合集中力量发展，感情志趣相投，财运集中投资获利，身心需要集中精力。", // 44-萃卦
        "升卦代表上升发展，步步高升。事业持续上升发展迅速，感情关系不断升华，财运步步高升收入增加，身心向上发展。", // 45-升卦
        "困卦象征困顿艰难，需要坚守。事业陷入困境需要坚持等待，感情遇到困难需要相互支持，财运紧张需要开源节流，身心疲惫需要坚持。", // 46-困卦
        "井卦代表水井永续，源源不断。事业如井水需要深挖稳定来源，感情需要深度交流，财运需要稳定持续的收入，身心需要源头活水。", // 47-井卦
        "革卦象征变革改革，除旧布新。事业需要改革创新适应时代，感情需要改变相处模式，财运需要改变理财方式，身心需要革新。", // 48-革卦
        "鼎卦代表鼎力相助，承载重任。事业需要承担重要责任，感情需要相互支撑，财运需要承担家庭责任，身体需要承载重任。", // 49-鼎卦
        "震卦象征震动觉醒，一鸣惊人。事业可能有突破性发展，感情可能有激动人心的变化，财运可能有意外收获，身心需要适应震动。", // 50-震卦
        "艮卦代表停止静止，适可而止。事业需要适时停止扩张，感情需要保持稳定，财运需要见好就收，身心需要静养休息。", // 51-艮卦
        "渐卦象征渐进发展，循序渐进。事业需要稳步发展不可急躁，感情需要慢慢培养，财运需要逐步积累，身体需要循序渐进地调养。", // 52-渐卦
        "归妹卦代表归从嫁娶，但有不利。事业合作需要谨慎选择对象，感情虽有归宿但需要考虑清楚，财运有收入但不够稳定，身心需要调适。", // 53-归妹卦
        "丰卦象征丰收充实，盛极而衰。事业正值巅峰但需要居安思危，感情充实美满但需要保持，财运丰厚但需要理性投资，身心充实但需适度。", // 54-丰卦
        "旅卦代表旅行漂泊，居无定所。事业需要在变动中寻找机会，感情需要在分离中保持联系，财运不够稳定需要节俭，身心需要适应变化。", // 55-旅卦
        "巽卦象征风的力量，温和渗透。事业需要温和的推进方式，感情需要温柔的沟通，财运通过温和的方式获得，身心需要柔和的调养。", // 56-巽卦
        "兑卦代表喜悦欢乐，开心快乐。事业发展令人欢喜，感情甜蜜快乐，财运带来喜悦，身心愉悦健康。", // 57-兑卦
        "涣卦象征涣散分离，需要凝聚。事业可能面临团队分散需要凝聚力，感情可能疏远需要加强联系，财运分散需要集中管理，身心涣散需要集中。", // 58-涣卦
        "节卦代表节制调节，适度为宜。事业需要节制发展速度，感情需要适度表达，财运需要节制消费，身体需要节制饮食作息。", // 59-节卦
        "中孚卦象征诚信真诚，以诚待人。事业需要诚信经营建立口碑，感情需要真诚相待，财运来自诚信经营，身心需要真诚面对自己。", // 60-中孚卦
        "小过卦代表小有过错，需要谨慎。事业虽有小错但不影响大局，感情有小摩擦但不伤大雅，财运有小损失但可以承受，身体有小毛病需要注意。", // 61-小过卦
        "既济卦象征功成名就，但需保持。事业已经成功但需要保持成果，感情美满但需要维护，财运丰厚但需要管理，身心达到平衡需要维持。", // 62-既济卦
        "未济卦代表尚未完成，仍需努力。事业还没有完全成功需要继续努力，感情还需要进一步发展，财运还有上升空间，身心还需要继续调理。" // 63-未济卦
    };
    
    // ==================== 吉凶等级 ====================
    private static final String[] LUCK_LEVELS = {
        "大吉", "中吉", "大吉", "中吉", "中吉", "凶", "平", "中吉", // 前8卦
        "平", "中吉", "大吉", "凶", "中吉", "大吉", "中吉", "中吉", // 9-16卦
        "平", "平", "中吉", "平", "平", "中吉", "凶", "中吉", // 17-24卦
        "中吉", "中吉", "平", "凶", "凶", "中吉", "平", "平", // 25-32卦
        "平", "中吉", "中吉", "凶", "中吉", "凶", "凶", "中吉", // 33-40卦
        "平", "中吉", "中吉", "平", "中吉", "中吉", "凶", "中吉", // 41-48卦
        "中吉", "中吉", "平", "平", "中吉", "平", "中吉", "平", // 49-56卦
        "中吉", "中吉", "中吉", "中吉", "中吉", "平", "中吉", "平" // 57-64卦
    };
    
    // ==================== 核心算法方法 ====================
    
    /**
     * 根据随机数生成卦象
     * @param randomNumbers 6个随机数数组
     * @return DivinationResult 卜卦结果
     */
    public static DivinationResult generateDivination(int[] randomNumbers) {
        if (randomNumbers == null || randomNumbers.length != 6) {
            throw new IllegalArgumentException("需要6个随机数来生成六爻");
        }
        
        // 生成六爻（从下到上）
        boolean[] yaoArray = new boolean[6];
        for (int i = 0; i < 6; i++) {
            // 传统算法：奇数为阳爻，偶数为阴爻
            yaoArray[i] = (randomNumbers[i] % 2) == 1;
        }
        
        // 计算卦号
        int guaNumber = calculateGuaNumber(yaoArray);
        
        // 创建结果对象
        DivinationResult result = new DivinationResult(guaNumber, GUA_NAMES[guaNumber], yaoArray);
        
        // 设置详细信息
        result.setGuaSymbol(GUA_SYMBOLS[guaNumber]);
        result.setGuaCi(getGuaCi(guaNumber));
        result.setXiangCi("象曰：" + getXiangCi(guaNumber));
        result.setModernInterpretation(getModernInterpretation(guaNumber));
        result.setJudgement(getJudgement(guaNumber));
        result.setLuckLevel(LUCK_LEVELS[guaNumber]);
        result.setAdvice(getAdvice(guaNumber));
        
        // 设置上下卦信息
        setUpperLowerGua(result, yaoArray);
        
        // 设置爻辞
        result.setYaoCi(generateYaoCi(yaoArray, guaNumber));
        
        return result;
    }
    
    /**
     * 计算卦号（0-63）
     */
    private static int calculateGuaNumber(boolean[] yaoArray) {
        int number = 0;
        for (int i = 0; i < 6; i++) {
            if (yaoArray[i]) { // 阳爻为1，阴爻为0
                number |= (1 << i);
            }
        }
        return number;
    }
    
    /**
     * 设置上下卦信息
     */
    private static void setUpperLowerGua(DivinationResult result, boolean[] yaoArray) {
        // 下卦（初爻、二爻、三爻）
        int lowerIndex = 0;
        if (yaoArray[0]) lowerIndex += 1;
        if (yaoArray[1]) lowerIndex += 2;
        if (yaoArray[2]) lowerIndex += 4;
        result.setLowerGua(BAGUA_NAMES[lowerIndex] + "(" + BAGUA_NATURE[lowerIndex] + ")");
        
        // 上卦（四爻、五爻、上爻）
        int upperIndex = 0;
        if (yaoArray[3]) upperIndex += 1;
        if (yaoArray[4]) upperIndex += 2;
        if (yaoArray[5]) upperIndex += 4;
        result.setUpperGua(BAGUA_NAMES[upperIndex] + "(" + BAGUA_NATURE[upperIndex] + ")");
    }
    
    /**
     * 获取卦辞
     */
    private static String getGuaCi(int guaNumber) {
        if (guaNumber < GUA_CI.length) {
            return GUA_CI[guaNumber];
        }
        return "此卦吉凶参半，需谨慎行事。";
    }
    
    /**
     * 获取象辞
     */
    private static String getXiangCi(int guaNumber) {
        // 完整的象辞数组
        String[] xiangTemplates = {
            "天行健，君子以自强不息", // 0-乾卦
            "地势坤，君子以厚德载物", // 1-坤卦
            "云雷屯，君子以经纶", // 2-屯卦
            "山下出泉蒙，君子以果行育德", // 3-蒙卦
            "云上于天需，君子以饮食宴乐", // 4-需卦
            "天与水违行讼，君子以作事谋始", // 5-讼卦
            "地中有水师，君子以容民畜众", // 6-师卦
            "水在地上比，先王以建万国，亲诸侯", // 7-比卦
            "风行天上小畜，君子以懿文德", // 8-小畜卦
            "上天下泽履，君子以辨上下，定民志", // 9-履卦
            "天地交泰，后以财成天地之道，辅相天地之宜", // 10-泰卦
            "天地不交否，君子以俭德辟难，不可荣以禄", // 11-否卦
            "天与火同人，君子以类族辨物", // 12-同人卦
            "火在天上大有，君子以遏恶扬善，顺天休命", // 13-大有卦
            "地中有山谦，君子以裒多益寡，称物平施", // 14-谦卦
            "雷出地奋豫，先王以作乐崇德，殷荐之上帝", // 15-豫卦
            "泽中有雷随，君子以向晦入宴息", // 16-随卦
            "山下有风蛊，君子以振民育德", // 17-蛊卦
            "泽上有地临，君子以教思无穷，容保民无疆", // 18-临卦
            "风行地上观，先王以省方，观民设教", // 19-观卦
            "雷电噬嗑，先王以明罚敕法", // 20-噬嗑卦
            "山下有火贲，君子以明庶政，无敢折狱", // 21-贲卦
            "山附于地剥，上以厚下，安宅", // 22-剥卦
            "雷在地中复，先王以至日闭关，商旅不行", // 23-复卦
            "天下雷行无妄，先王以茂对时，育万物", // 24-无妄卦
            "天在山中大畜，君子以多识前言往行，以畜其德", // 25-大畜卦
            "山下有雷颐，君子以慎言语，节饮食", // 26-颐卦
            "泽灭木大过，君子以独立不惧，遯世无闷", // 27-大过卦
            "水洊至习坎，君子以常德行，习教事", // 28-坎卦
            "明两作离，大人以继明照于四方", // 29-离卦
            "山上有泽咸，君子以虚受人", // 30-咸卦
            "雷风恒，君子以立不易方", // 31-恒卦
            "天下有山遁，君子以远小人，不恶而严", // 32-遁卦
            "雷在天上大壮，君子以非礼弗履", // 33-大壮卦
            "明出地上晋，君子以自昭明德", // 34-晋卦
            "明入地中明夷，君子以莅众，用晦而明", // 35-明夷卦
            "风自火出家人，君子以言有物，而行有恒", // 36-家人卦
            "上火下泽睽，君子以同而异", // 37-睽卦
            "山上有水蹇，君子以反身修德", // 38-蹇卦
            "雷雨作解，君子以赦过宥罪", // 39-解卦
            "山下有泽损，君子以惩忿窒欲", // 40-损卦
            "风雷益，君子以见善则迁，有过则改", // 41-益卦
            "泽上于天夬，君子以施禄及下，居德则忌", // 42-夬卦
            "天下有风姤，后以施命诰四方", // 43-姤卦
            "泽上于地萃，君子以除戎器，戒不虞", // 44-萃卦
            "地中生木升，君子以顺德，积小以高大", // 45-升卦
            "泽无水困，君子以致命遂志", // 46-困卦
            "木上有水井，君子以劳民劝相", // 47-井卦
            "泽中有火革，君子以治历明时", // 48-革卦
            "木上有火鼎，君子以正位凝命", // 49-鼎卦
            "洊雷震，君子以恐惧修省", // 50-震卦
            "兼山艮，君子以思不出其位", // 51-艮卦
            "山上有木渐，君子以居贤德善俗", // 52-渐卦
            "雷泽归妹，君子以永终知敝", // 53-归妹卦
            "雷电皆至丰，君子以折狱致刑", // 54-丰卦
            "山上有火旅，君子以明慎用刑，而不留狱", // 55-旅卦
            "随风巽，君子以申命行事", // 56-巽卦
            "丽泽兑，君子以朋友讲习", // 57-兑卦
            "风行水上涣，先王以享于帝立庙", // 58-涣卦
            "泽上有水节，君子以制数度，议德行", // 59-节卦
            "泽上有风中孚，君子以议狱缓死", // 60-中孚卦
            "山上有雷小过，君子以行过乎恭，丧过乎哀，用过乎俭", // 61-小过卦
            "水在火上既济，君子以思患而豫防之", // 62-既济卦
            "火在水上未济，君子以慎辨物居方" // 63-未济卦
        };
        
        if (guaNumber >= 0 && guaNumber < xiangTemplates.length) {
            return xiangTemplates[guaNumber];
        }
        return "此象提示需要顺应天时，把握时机。";
    }
    
    /**
     * 获取现代解释
     */
    private static String getModernInterpretation(int guaNumber) {
        if (guaNumber < MODERN_INTERPRETATIONS.length) {
            return MODERN_INTERPRETATIONS[guaNumber];
        }
        return "运势起伏不定，需要保持平常心，顺其自然发展。";
    }
    
    /**
     * 获取判断（吉凶）
     */
    private static String getJudgement(int guaNumber) {
        return LUCK_LEVELS[guaNumber];
    }
    
    /**
     * 获取建议
     */
    private static String getAdvice(int guaNumber) {
        String luckLevel = LUCK_LEVELS[guaNumber];
        switch (luckLevel) {
            case "大吉":
                String[] dajiAdvice = {
                    "运势极佳，正是大展宏图的绝佳时机。可大胆行事，把握机遇，积极进取，但要保持谦逊，不可骄傲自满。",
                    "天时地利人和皆备，宜抓住这难得的机会。行事果断，投资创业皆宜，但需居安思危，为未来做好准备。",
                    "吉星高照，万事如意。此时行动必有收获，合作必有成果，但要懂得感恩，与人为善，福报才能持久。",
                    "运势如虹，前程似锦。宜乘势而上，扩大成果，但要记住盛极必衰的道理，保持平常心最为重要。"
                };
                return dajiAdvice[(int)(System.nanoTime() % dajiAdvice.length)];
            case "中吉":
                String[] zhongjiAdvice = {
                    "运势良好，适合稳步前进。保持现状基础上小心经营，谨慎行事，切勿冒进，耐心等待更好时机。",
                    "形势向好，但需要持续努力。循序渐进，脚踏实地，与人为善，建立良好人际关系，成功在望。",
                    "运势平稳上升，宜守成待机。专注本职工作，提升个人能力，保持低调务实的态度，前途可期。",
                    "机会逐渐显现，需要耐心等待。继续努力不懈，保持积极心态，相信付出必有回报，时机成熟自然水到渠成。"
                };
                return zhongjiAdvice[(int)(System.nanoTime() % zhongjiAdvice.length)];
            case "平":
                String[] pingAdvice = {
                    "运势平稳如常，宜守不宜攻。保持耐心，静观其变，养精蓄锐，等待时机成熟再行动。",
                    "目前处于过渡期，需要沉着应对。专心做好本分事，不要急躁冒进，平常心对待一切变化。",
                    "运势处于平衡状态，需要谨慎维护。避免大的变动，稳扎稳打，积累实力，为将来发展打好基础。",
                    "时运平平，但危机并存机遇。保持理性分析，审时度势，既不可过于悲观，也不能盲目乐观。"
                };
                return pingAdvice[(int)(System.nanoTime() % pingAdvice.length)];
            case "凶":
                String[] xiongAdvice = {
                    "运势不佳，需要谨慎行事。避免冒险决策，低调做人，静待转机，相信困难只是暂时的。",
                    "时运不济，宜退守保身。减少不必要的支出，避免与人冲突，调整心态，积极面对挑战。",
                    "处于困难时期，需要坚持忍耐。寻求他人帮助，团结协作，化解危机，困境终将过去。",
                    "运势低迷，但要保持信心。反思过往得失，总结经验教训，为东山再起做好准备。"
                };
                return xiongAdvice[(int)(System.nanoTime() % xiongAdvice.length)];
            case "大凶":
                String[] daxiongAdvice = {
                    "运势极差，务必退守保身。避免一切重大决策，专注保护既有成果，等待运势回转。",
                    "面临重大挑战，需要冷静应对。寻求专业帮助，依靠亲友支持，共渡难关，切勿独自承担。",
                    "时运极为不利，宜蛰伏待时。停止扩张计划，专注保命要紧，相信黑暗过后必见光明。",
                    "危机重重，需要极度谨慎。保守行事，避免风险，调养身心，为将来的复苏积蓄力量。"
                };
                return daxiongAdvice[(int)(System.nanoTime() % daxiongAdvice.length)];
            default:
                return "保持平常心，顺应自然规律，以不变应万变。";
        }
    }
    
    /**
     * 生成爻辞
     */
    private static String[] generateYaoCi(boolean[] yaoArray, int guaNumber) {
        String[] yaoCi = new String[6];
        String[] positions = {"初", "二", "三", "四", "五", "上"};
        
        for (int i = 0; i < 6; i++) {
            String yaoType = yaoArray[i] ? "九" : "六";
            yaoCi[i] = yaoType + positions[i] + "：" + getYaoInterpretation(i, yaoArray[i], guaNumber);
        }
        
        return yaoCi;
    }
    
    /**
     * 获取爻的解释
     */
    private static String getYaoInterpretation(int position, boolean isYang, int guaNumber) {
        // 乾卦和坤卦的经典爻辞
        if (guaNumber == 0) { // 乾卦
            String[] qianYaoCi = {"潜龙勿用", "见龙在田，利见大人", "君子终日乾乾，夕惕若厉，无咎", "或跃在渊，无咎", "飞龙在天，利见大人", "亢龙有悔"};
            if (position < qianYaoCi.length) return qianYaoCi[position];
        } else if (guaNumber == 1) { // 坤卦
            String[] kunYaoCi = {"履霜，坚冰至", "直方大，不习无不利", "含章可贞，或从王事，无成有终", "括囊，无咎无誉", "黄裳，元吉", "龙战于野，其血玄黄"};
            if (position < kunYaoCi.length) return kunYaoCi[position];
        }
        
        // 其他卦的爻辞模板
        String[] yangTemplates = {
            "初始阶段，阳气初生，宜谨慎行事，积蓄力量",
            "阳气渐盛，时机显现，可适度行动，但需稳重",
            "阳气正盛，能力充足，可积极进取，发挥才能", 
            "阳气过盛，需要调节，避免过度，保持平衡",
            "阳气达极，位高权重，需要谦逊，不可骄傲",
            "阳气过极，盛极必衰，需要反思，适时退让"
        };
        
        String[] yinTemplates = {
            "阴气初现，柔弱之始，需要谨慎，等待时机",
            "阴气渐强，柔顺有力，可以配合，发挥作用",
            "阴气正盛，柔中有刚，既要坚持，又要灵活",
            "阴气稍过，需要收敛，避免软弱，保持底线", 
            "阴气鼎盛，以柔制刚，善用智慧，化解困境",
            "阴气过极，柔弱无力，需要求助，借力而行"
        };
        
        if (isYang && position < yangTemplates.length) {
            return yangTemplates[position];
        } else if (!isYang && position < yinTemplates.length) {
            return yinTemplates[position];
        }
        
        return isYang ? "阳爻当位，积极进取，吉利亨通" : "阴爻守正，柔顺应变，平安无事";
    }
    
    // ==================== 辅助方法 ====================
    
    /**
     * 根据卦号获取卦名
     */
    public static String getGuaName(int guaNumber) {
        if (guaNumber >= 0 && guaNumber < GUA_NAMES.length) {
            return GUA_NAMES[guaNumber];
        }
        return "未知卦";
    }
    
    /**
     * 根据爻数组生成卦象文本显示
     */
    public static String generateGuaText(boolean[] yaoArray) {
        StringBuilder sb = new StringBuilder();
        // 从上爻到下爻显示（传统显示方式）
        for (int i = 5; i >= 0; i--) {
            if (yaoArray[i]) {
                sb.append("━━━ (阳爻)\n"); // 阳爻：连续线
            } else {
                sb.append("━ ━ (阴爻)\n"); // 阴爻：断开线
            }
        }
        return sb.toString().trim();
    }
    
    /**
     * 验证卦象的合法性
     */
    public static boolean isValidGua(boolean[] yaoArray) {
        return yaoArray != null && yaoArray.length == 6;
    }
}